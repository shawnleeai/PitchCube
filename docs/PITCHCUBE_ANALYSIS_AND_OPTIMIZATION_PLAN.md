# PitchCube é¡¹ç›®ç°çŠ¶åˆ†æä¸ä¼˜åŒ–æ–¹æ¡ˆ

> æ–‡æ¡£ç”Ÿæˆæ—¥æœŸï¼š2026-02-01
> åˆ†æèŒƒå›´ï¼šå‰ç«¯ã€åç«¯ã€æ•°æ®åº“ã€AIæœåŠ¡ã€éƒ¨ç½²è¿ç»´

---

## ğŸ“Š ä¸€ã€é¡¹ç›®ç°çŠ¶æ¦‚è§ˆ

### 1.1 æ¶æ„æ¦‚è¿°

PitchCube é‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„å¾®æœåŠ¡æ¶æ„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯å±‚ (Next.js)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   é¦–é¡µ      â”‚  ç”Ÿæˆå™¨     â”‚   ä»ªè¡¨ç›˜    â”‚    ç™»å½•/æ³¨å†Œ       â”‚
â”‚  (Landing)  â”‚  (Generate) â”‚ (Dashboard) â”‚   (Auth)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API ç½‘å…³ (FastAPI)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  /auth   â”‚ /users   â”‚/products â”‚ /posters â”‚   /videos       â”‚
â”‚  è®¤è¯    â”‚  ç”¨æˆ·    â”‚  äº§å“    â”‚  æµ·æŠ¥    â”‚   è§†é¢‘          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                  â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   MongoDB   â”‚    â”‚    Redis    â”‚    â”‚  AI Servicesâ”‚
   â”‚  (ä¸»æ•°æ®åº“)  â”‚    â”‚  (ç¼“å­˜/é˜Ÿåˆ—) â”‚    â”‚ (å¯é€‰å¢å¼º)   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æŠ€æœ¯æ ˆæ¸…å•

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | çŠ¶æ€ |
|------|----------|------|------|
| å‰ç«¯æ¡†æ¶ | Next.js | 15.x | âœ… å·²é…ç½® |
| å‰ç«¯è¯­è¨€ | TypeScript | 5.x | âœ… å·²é…ç½® |
| UI æ ·å¼ | Tailwind CSS | 3.x | âœ… å·²é…ç½® |
| åŠ¨ç”»åº“ | Framer Motion | - | âœ… å·²é…ç½® |
| å›¾æ ‡åº“ | Lucide React | - | âœ… å·²é…ç½® |
| åç«¯æ¡†æ¶ | FastAPI | 0.115+ | âœ… å·²é…ç½® |
| åç«¯è¯­è¨€ | Python | 3.11+ | âœ… å·²é…ç½® |
| æ•°æ®åº“ | MongoDB | 6.0+ | âš ï¸ ä»…è¿æ¥é…ç½® |
| ç¼“å­˜ | Redis | 7.0+ | âš ï¸ ä»…è¿æ¥é…ç½® |
| éƒ¨ç½² | Docker + Compose | - | âœ… å·²é…ç½® |

---

## ğŸ“‹ äºŒã€åŠŸèƒ½æ¨¡å—è¯¦ç»†åˆ†æ

### 2.1 å…­å¤§é­”æ–¹æ¨¡å—çŠ¶æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PitchCube åŠŸèƒ½çŸ©é˜µ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    æ¨¡å—      â”‚    å‰ç«¯UI    â”‚   åç«¯API    â”‚   å®é™…åŠŸèƒ½    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¨ æµ·æŠ¥å·¥åŠ   â”‚     âœ…       â”‚     âš ï¸       â”‚     âš ï¸        â”‚
â”‚ ğŸ¬ è§†é¢‘æ¼”æ’­å®¤ â”‚     âœ…       â”‚     âš ï¸       â”‚     âš ï¸        â”‚
â”‚ ğŸ–¨ï¸ IPé“¸é€ å‚   â”‚     âœ…       â”‚     âŒ       â”‚     âŒ        â”‚
â”‚ ğŸ¤ è¯­éŸ³è§£è¯´å‘˜ â”‚     âœ…       â”‚     âŒ       â”‚     âŒ        â”‚
â”‚ ğŸ‘¥ åä½œç©ºé—´   â”‚     âŒ       â”‚     âŒ       â”‚     âŒ        â”‚
â”‚ ğŸ“Š æ•°æ®é­”é•œ   â”‚     âŒ       â”‚     âŒ       â”‚     âŒ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å›¾ä¾‹: âœ… å®Œæˆ  âš ï¸ éƒ¨åˆ†å®Œæˆ/æ¨¡æ‹Ÿå®ç°  âŒ æœªå¼€å§‹
```

### 2.2 å„æ¨¡å—è¯¦ç»†åˆ†æ

#### ğŸ¨ æµ·æŠ¥å·¥åŠ (Poster Workshop)

| åŠŸèƒ½ç‚¹ | å®ç°çŠ¶æ€ | è¯¦ç»†è¯´æ˜ |
|--------|----------|----------|
| æ¨¡æ¿é€‰æ‹©ç•Œé¢ | âœ… å®Œæˆ | 4ç§é¢„è®¾æ¨¡æ¿å±•ç¤ºï¼ˆç§‘æŠ€ç°ä»£ã€åˆ›ä¸šå®£è¨€ã€æç®€ä¸»ä¹‰ã€åˆ›æ„æ¸å˜ï¼‰|
| äº§å“ä¿¡æ¯è¡¨å• | âœ… å®Œæˆ | åç§°ã€æè¿°ã€åŠŸèƒ½ã€å—ä¼—è¾“å…¥ |
| ç”Ÿæˆæµç¨‹UI | âœ… å®Œæˆ | ä¸‰æ­¥æµç¨‹ï¼ˆé€‰æ‹©â†’è¾“å…¥â†’ç»“æœï¼‰|
| åç«¯ç”ŸæˆAPI | âš ï¸ Mock | POST /posters/generate ä»…è¿”å›æ¨¡æ‹Ÿæ•°æ® |
| çŠ¶æ€æŸ¥è¯¢API | âš ï¸ Mock | GET /posters/generations/{id} è¿”å›å›ºå®šæ•°æ® |
| çœŸå®AIç”Ÿæˆ | âŒ æœªå®ç° | éœ€è¦æ¥å…¥ Stability AI / DALL-E |
| å›¾ç‰‡æ¸²æŸ“å¼•æ“ | âŒ æœªå®ç° | éœ€è¦å®ç° HTMLâ†’å›¾ç‰‡â†’PDF è½¬æ¢ |
| æ¨¡æ¿ç®¡ç†ç³»ç»Ÿ | âŒ æœªå®ç° | æ¨¡æ¿CRUDã€åŠ¨æ€æ·»åŠ  |

**å½“å‰ä»£ç åˆ†æ** (`backend/app/services/poster_generator.py`):
```python
# å½“å‰ä»…å®ç° Mock ç”Ÿæˆ
async def generate_mock(self, request) -> dict:
    # ä»…éšæœºé€‰æ‹©æ¨¡æ¿ï¼Œæ— å®é™…æ¸²æŸ“
    template_id = request.template_id or random.choice(self.templates)
    await asyncio.sleep(2)  # æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
    return {
        "preview_url": f"/generated/{generation_id}_preview.png",  # ä¸å­˜åœ¨
        # ... æ¨¡æ‹Ÿæ•°æ®
    }
```

#### ğŸ¬ è§†é¢‘æ¼”æ’­å®¤ (Video Studio)

| åŠŸèƒ½ç‚¹ | å®ç°çŠ¶æ€ | è¯¦ç»†è¯´æ˜ |
|--------|----------|----------|
| è§†é¢‘è„šæœ¬ç”ŸæˆUI | âœ… å®Œæˆ | æ—¶é•¿ã€é£æ ¼ã€å¹³å°é€‰æ‹© |
| è„šæœ¬ç”ŸæˆAPI | âš ï¸ Mock | è¿”å›å›ºå®šåœºæ™¯æ¨¡æ¿ |
| çœŸå®è§†é¢‘ç”Ÿæˆ | âŒ æœªå®ç° | éœ€è¦æ¥å…¥ RunwayML / Pika Labs |
| è¯­éŸ³åˆæˆ | âŒ æœªå®ç° | Azure Speech å¾…æ¥å…¥ |
| å­—å¹•ç”Ÿæˆ | âŒ æœªå®ç° | éœ€è¦å®ç°å­—å¹•æ—¶é—´è½´ |
| è§†é¢‘æ¸²æŸ“å¼•æ“ | âŒ æœªå®ç° | FFmpeg è§†é¢‘åˆæˆ |

**å½“å‰ä»£ç åˆ†æ** (`backend/app/api/v1/videos.py`):
```python
# è„šæœ¬ç”Ÿæˆä»…è¿”å›å›ºå®šæ¨¡æ¿
scene_templates = [
    {"visual": "å¼€åœºç”»é¢ï¼šäº§å“LogoåŠ¨ç”»...", "narration": "æƒ³è±¡ä¸€ä¸‹...", ...},
    # å›ºå®š5ä¸ªåœºæ™¯ï¼Œæ— AIç”Ÿæˆ
]
```

#### ğŸ–¨ï¸ IPé“¸é€ å‚ (IP Foundry)

| åŠŸèƒ½ç‚¹ | å®ç°çŠ¶æ€ | è¯¦ç»†è¯´æ˜ |
|--------|----------|----------|
| UIç•Œé¢ | âœ… å®Œæˆ | ç”Ÿæˆå™¨é¡µé¢åŒ…å«é€‰é¡¹ |
| åç«¯API | âŒ æœªå®ç° | æ— ç›¸å…³è·¯ç”± |
| 3Dæ¨¡å‹ç”Ÿæˆ | âŒ æœªå®ç° | éœ€è¦æ¥å…¥ Tripo3D / Meshy |
| STL/OBJå¯¼å‡º | âŒ æœªå®ç° | 3Dæ–‡ä»¶æ ¼å¼å¤„ç† |
| æ‰“å°æœåŠ¡å¯¹æ¥ | âŒ æœªå®ç° | åœ¨çº¿3Dæ‰“å°API |

#### ğŸ¤ è¯­éŸ³è§£è¯´å‘˜ (Voice Narrator)

| åŠŸèƒ½ç‚¹ | å®ç°çŠ¶æ€ | è¯¦ç»†è¯´æ˜ |
|--------|----------|----------|
| UIç•Œé¢ | âœ… å®Œæˆ | ç”Ÿæˆå™¨é¡µé¢åŒ…å«é€‰é¡¹ |
| åç«¯API | âŒ æœªå®ç° | æ— ç›¸å…³è·¯ç”± |
| è¯­éŸ³åˆæˆ | âŒ æœªå®ç° | Azure Speech / ElevenLabs |
| å¤šè¯­è¨€æ”¯æŒ | âŒ æœªå®ç° | ä¸­è‹±æ–‡è¯­éŸ³ |
| é£æ ¼åˆ‡æ¢ | âŒ æœªå®ç° | ä¸“ä¸š/æ´»æ³¼/æ²‰ç¨³ç­‰é£æ ¼ |

#### ğŸ‘¥ åä½œç©ºé—´ (Collaboration Space)

| åŠŸèƒ½ç‚¹ | å®ç°çŠ¶æ€ | è¯¦ç»†è¯´æ˜ |
|--------|----------|----------|
| UIç•Œé¢ | âŒ æœªå®ç° | è§„åˆ’ä¸­ |
| åç«¯API | âŒ æœªå®ç° | éœ€è¦WebSocketæ”¯æŒ |
| å®æ—¶åä½œ | âŒ æœªå®ç° | Yjs / Socket.io |
| ç‰ˆæœ¬ç®¡ç† | âŒ æœªå®ç° | Git-likeç‰ˆæœ¬æ§åˆ¶ |
| æƒé™ç³»ç»Ÿ | âŒ æœªå®ç° | RBACæƒé™æ¨¡å‹ |

#### ğŸ“Š æ•°æ®é­”é•œ (Data Mirror)

| åŠŸèƒ½ç‚¹ | å®ç°çŠ¶æ€ | è¯¦ç»†è¯´æ˜ |
|--------|----------|----------|
| UIç•Œé¢ | âŒ æœªå®ç° | è§„åˆ’ä¸­ |
| åç«¯API | âŒ æœªå®ç° | æ•°æ®åˆ†ææ¥å£ |
| A/Bæµ‹è¯• | âŒ æœªå®ç° | å¯¹æ¯”å®éªŒç³»ç»Ÿ |
| æ•°æ®å¯è§†åŒ– | âŒ æœªå®ç° | å›¾è¡¨å±•ç¤º |
| ä¼˜åŒ–å»ºè®® | âŒ æœªå®ç° | AIåˆ†æå»ºè®® |

---

## ğŸ”§ ä¸‰ã€åç«¯APIå®ç°çŠ¶æ€

### 3.1 APIè·¯ç”±æ¸…å•

```
/api/v1
â”œâ”€â”€ /health                 âœ… å®Œæˆ - å¥åº·æ£€æŸ¥
â”œâ”€â”€ /auth
â”‚   â”œâ”€â”€ POST /register      âœ… å®Œæˆ - ç”¨æˆ·æ³¨å†Œï¼ˆMockï¼‰
â”‚   â”œâ”€â”€ POST /token         âœ… å®Œæˆ - OAuth2ç™»å½•ï¼ˆå›ºå®šè´¦å·ï¼‰
â”‚   â”œâ”€â”€ POST /login         âœ… å®Œæˆ - JSONç™»å½•ï¼ˆå›ºå®šè´¦å·ï¼‰
â”‚   â”œâ”€â”€ POST /refresh       âœ… å®Œæˆ - Tokenåˆ·æ–°
â”‚   â””â”€â”€ POST /logout        âœ… å®Œæˆ - ç™»å‡º
â”œâ”€â”€ /users
â”‚   â”œâ”€â”€ GET /me             âœ… å®Œæˆ - è·å–å½“å‰ç”¨æˆ·ï¼ˆMockï¼‰
â”‚   â”œâ”€â”€ PUT /me             âœ… å®Œæˆ - æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆMockï¼‰
â”‚   â””â”€â”€ GET /me/stats       âœ… å®Œæˆ - ç”¨æˆ·ç»Ÿè®¡ï¼ˆMockï¼‰
â”œâ”€â”€ /products
â”‚   â”œâ”€â”€ POST /              âœ… å®Œæˆ - åˆ›å»ºäº§å“ï¼ˆæ— æŒä¹…åŒ–ï¼‰
â”‚   â”œâ”€â”€ GET /               âš ï¸ å®Œæˆ - è¿”å›ç©ºæ•°ç»„
â”‚   â”œâ”€â”€ GET /{id}           âš ï¸ å®Œæˆ - è¿”å›404
â”‚   â”œâ”€â”€ PUT /{id}           âš ï¸ å®Œæˆ - è¿”å›404
â”‚   â”œâ”€â”€ DELETE /{id}        âš ï¸ å®Œæˆ - ç©ºæ“ä½œ
â”‚   â”œâ”€â”€ POST /{id}/analyze  âœ… å®Œæˆ - è¿”å›å›ºå®šåˆ†æç»“æœ
â”‚   â””â”€â”€ GET /{id}/suggestions âœ… å®Œæˆ - è¿”å›å›ºå®šå»ºè®®
â”œâ”€â”€ /posters
â”‚   â”œâ”€â”€ GET /templates      âœ… å®Œæˆ - è¿”å›4ä¸ªå›ºå®šæ¨¡æ¿
â”‚   â”œâ”€â”€ GET /templates/{id} âœ… å®Œæˆ - è¿”å›æŒ‡å®šæ¨¡æ¿
â”‚   â”œâ”€â”€ POST /generate      âš ï¸ å®Œæˆ - å¼‚æ­¥Mockç”Ÿæˆ
â”‚   â”œâ”€â”€ GET /generations    âš ï¸ å®Œæˆ - è¿”å›ç©ºæ•°ç»„
â”‚   â””â”€â”€ GET /generations/{id} âš ï¸ å®Œæˆ - è¿”å›å›ºå®šæ•°æ®
â””â”€â”€ /videos
    â”œâ”€â”€ GET /templates      âœ… å®Œæˆ - è¿”å›3ä¸ªå›ºå®šæ¨¡æ¿
    â”œâ”€â”€ POST /generate-script âš ï¸ å®Œæˆ - è¿”å›å›ºå®šè„šæœ¬
    â”œâ”€â”€ POST /generate      âš ï¸ å®Œæˆ - è¿”å›processingçŠ¶æ€
    â””â”€â”€ GET /generations/{id} âš ï¸ å®Œæˆ - è¿”å›å›ºå®šæ•°æ®

ç¼ºå¤±è·¯ç”±:
â”œâ”€â”€ /posters/batch          âŒ æœªå®ç° - æ‰¹é‡ç”Ÿæˆ
â”œâ”€â”€ /ip                     âŒ æœªå®ç° - IPå½¢è±¡ç”Ÿæˆ
â”œâ”€â”€ /voice                  âŒ æœªå®ç° - è¯­éŸ³ç”Ÿæˆ
â”œâ”€â”€ /collaboration          âŒ æœªå®ç° - åä½œåŠŸèƒ½
â”œâ”€â”€ /analytics              âŒ æœªå®ç° - æ•°æ®åˆ†æ
â””â”€â”€ /payments               âŒ æœªå®ç° - æ”¯ä»˜è®¢é˜…
```

### 3.2 æ•°æ®åº“å®ç°çŠ¶æ€

| ç»„ä»¶ | å®ç°çŠ¶æ€ | è¯´æ˜ |
|------|----------|------|
| MongoDBè¿æ¥ | âœ… å®Œæˆ | motorå¼‚æ­¥é©±åŠ¨ |
| ç´¢å¼•åˆ›å»º | âœ… å®Œæˆ | users, products, poster_generations |
| æ•°æ®æ¨¡å‹ | âŒ æœªå®ç° | æ— Pydanticæ¨¡å‹ |
| CRUDæ“ä½œ | âŒ æœªå®ç° | æ‰€æœ‰APIæœªå®é™…è¯»å†™æ•°æ®åº“ |
| æ•°æ®è¿ç§» | âŒ æœªå®ç° | æ— è¿ç§»è„šæœ¬ |

---

## âš ï¸ å››ã€æ ¸å¿ƒé—®é¢˜è¯†åˆ«

### 4.1 å…³é”®é—®é¢˜åˆ—è¡¨

| ä¼˜å…ˆçº§ | é—®é¢˜ | å½±å“ | è§£å†³éš¾åº¦ |
|--------|------|------|----------|
| P0 | æ•°æ®åº“æœªå®é™…ä½¿ç”¨ | æ•°æ®æ— æ³•æŒä¹…åŒ– | ä¸­ |
| P0 | æµ·æŠ¥æ— çœŸå®ç”Ÿæˆ | æ ¸å¿ƒä¸šåŠ¡ä¸å¯ç”¨ | é«˜ |
| P0 | è§†é¢‘æ— çœŸå®ç”Ÿæˆ | æ ¸å¿ƒä¸šåŠ¡ä¸å¯ç”¨ | é«˜ |
| P1 | å‰ç«¯æœªå¯¹æ¥çœŸå®API | ç•Œé¢ä¸æ•°æ®åˆ†ç¦» | ä½ |
| P1 | ç¼ºå°‘IP/è¯­éŸ³åç«¯ | åŠŸèƒ½ä¸å®Œæ•´ | ä¸­ |
| P2 | ç¼ºå°‘æ”¯ä»˜ç³»ç»Ÿ | æ— æ³•å•†ä¸šåŒ– | ä¸­ |
| P2 | ç¼ºå°‘åä½œåŠŸèƒ½ | ç«äº‰åŠ›ä¸è¶³ | é«˜ |
| P3 | ç¼ºå°‘æ•°æ®åˆ†æ | æ— æ³•ä¼˜åŒ– | ä¸­ |

### 4.2 æŠ€æœ¯å€ºåŠ¡

```
1. Mockæ•°æ®è¿‡å¤š
   â”œâ”€â”€ æ‰€æœ‰APIè¿”å›å›ºå®š/éšæœºæ•°æ®
   â”œâ”€â”€ æ— æ³•æµ‹è¯•çœŸå®ä¸šåŠ¡åœºæ™¯
   â””â”€â”€ ç”¨æˆ·æ— æ³•çœ‹åˆ°å®é™…æ•ˆæœ

2. å‰ç«¯ç¡¬ç¼–ç 
   â”œâ”€â”€ ä»ªè¡¨ç›˜æ•°æ®å†™æ­»
   â”œâ”€â”€ ç”Ÿæˆç»“æœä»…ä¸ºå ä½å›¾
   â””â”€â”€ æ— å®é™…APIè°ƒç”¨

3. ç¼ºå°‘é”™è¯¯å¤„ç†
   â”œâ”€â”€ APIæ— å®Œå–„çš„é”™è¯¯å“åº”
   â”œâ”€â”€ å‰ç«¯æ— é”™è¯¯è¾¹ç•Œ
   â””â”€â”€ æ— é‡è¯•æœºåˆ¶

4. å®‰å…¨å¾…åŠ å¼º
   â”œâ”€â”€ JWT Secretä½¿ç”¨é»˜è®¤å€¼
   â”œâ”€â”€ æ— APIé™æµå®ç°
   â””â”€â”€ æ— è¾“å…¥éªŒè¯å¼ºåŒ–

5. æµ‹è¯•ç¼ºå¤±
   â”œâ”€â”€ æ— å•å…ƒæµ‹è¯•
   â”œâ”€â”€ æ— é›†æˆæµ‹è¯•
   â””â”€â”€ æ— E2Eæµ‹è¯•
```

---

## ğŸš€ äº”ã€è¯¦ç»†ä¼˜åŒ–æ–¹æ¡ˆ

### 5.1 é˜¶æ®µä¸€ï¼šæ ¸å¿ƒåŠŸèƒ½è½åœ°ï¼ˆé¢„è®¡4-6å‘¨ï¼‰

#### ä»»åŠ¡1.1ï¼šæ•°æ®åº“å±‚å®Œå–„

**ç›®æ ‡**ï¼šå®ç°çœŸå®çš„æ•°æ®æŒä¹…åŒ–

**å·¥ä½œå†…å®¹**ï¼š
```python
# 1. åˆ›å»ºæ•°æ®æ¨¡å‹æ–‡ä»¶ backend/app/models/
- user.py          # ç”¨æˆ·æ¨¡å‹
- product.py       # äº§å“æ¨¡å‹  
- poster.py        # æµ·æŠ¥ç”Ÿæˆè®°å½•
- video.py         # è§†é¢‘ç”Ÿæˆè®°å½•
- generation.py    # ç”Ÿæˆä»»åŠ¡åŸºç±»

# 2. å®ç° Repository æ¨¡å¼
- backend/app/repositories/base.py
- backend/app/repositories/user_repo.py
- backend/app/repositories/product_repo.py
- backend/app/repositories/poster_repo.py

# 3. æ›´æ–°æ‰€æœ‰APIä½¿ç”¨çœŸå®æ•°æ®åº“
- ä¿®æ”¹æ‰€æœ‰"In production"æ³¨é‡Šçš„ä»£ç 
- å®ç°å®Œæ•´çš„CRUD
```

**ä»£ç ç¤ºä¾‹**ï¼š
```python
# backend/app/models/user.py
from datetime import datetime
from typing import Optional
from pydantic import BaseModel, EmailStr, Field
from bson import ObjectId

class User(BaseModel):
    id: str = Field(default_factory=lambda: str(ObjectId()))
    email: EmailStr
    username: str
    hashed_password: str
    full_name: Optional[str] = None
    is_active: bool = True
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: datetime = Field(default_factory=datetime.utcnow)
    
    class Config:
        populate_by_name = True
        json_encoders = {ObjectId: str}

# backend/app/repositories/user_repo.py
from app.db.mongodb import db
from app.models.user import User

class UserRepository:
    collection_name = "users"
    
    async def create(self, user: User) -> User:
        result = await db.db[self.collection_name].insert_one(
            user.model_dump(by_alias=True)
        )
        user.id = str(result.inserted_id)
        return user
    
    async def get_by_email(self, email: str) -> Optional[User]:
        doc = await db.db[self.collection_name].find_one({"email": email})
        return User(**doc) if doc else None
    
    # ... å…¶ä»–CRUDæ–¹æ³•
```

#### ä»»åŠ¡1.2ï¼šæµ·æŠ¥ç”Ÿæˆå¼•æ“

**ç›®æ ‡**ï¼šå®ç°çœŸå®çš„æµ·æŠ¥å›¾ç‰‡ç”Ÿæˆ

**æŠ€æœ¯é€‰å‹**ï¼š
- æ–¹æ¡ˆAï¼šHTMLâ†’å›¾ç‰‡ (æ¨èç¬¬ä¸€é˜¶æ®µä½¿ç”¨)
  - Playwright + html-to-image
  - çµæ´»å¯æ§ï¼Œæ— éœ€AIæœåŠ¡
  - é€‚åˆæ¨¡æ¿åŒ–ç”Ÿæˆ
  
- æ–¹æ¡ˆBï¼šAIå›¾åƒç”Ÿæˆ (å¯é€‰å¢å¼º)
  - Stability AI API
  - DALL-E 3
  - æˆæœ¬é«˜ï¼Œè´¨é‡ä¸ç¨³å®š

**å®ç°æ–¹æ¡ˆ**ï¼š
```python
# backend/app/services/poster_renderer.py
from playwright.async_api import async_playwright
from jinja2 import Template
import aiofiles

class PosterRenderer:
    """HTMLæ¨¡æ¿æ¸²æŸ“å¼•æ“"""
    
    TEMPLATE_DIR = "templates/posters"
    
    async def render_poster(self, request: PosterRequest) -> bytes:
        # 1. åŠ è½½HTMLæ¨¡æ¿
        template = await self._load_template(request.template_id)
        
        # 2. æ¸²æŸ“æ•°æ®åˆ°HTML
        html_content = template.render(
            product_name=request.product_name,
            description=request.product_description,
            features=request.key_features,
            colors=self._get_template_colors(request.template_id),
            primary_color=request.primary_color or "#0ea5e9"
        )
        
        # 3. ä½¿ç”¨Playwrightæˆªå›¾
        async with async_playwright() as p:
            browser = await p.chromium.launch()
            page = await browser.new_page()
            await page.set_content(html_content)
            await page.set_viewport_size({"width": 1200, "height": 1600})
            
            screenshot = await page.screenshot(
                type="png",
                full_page=False
            )
            
            await browser.close()
            return screenshot
    
    async def convert_to_pdf(self, png_bytes: bytes) -> bytes:
        """PNGè½¬PDF"""
        from PIL import Image
        import io
        
        image = Image.open(io.BytesIO(png_bytes))
        if image.mode == 'RGBA':
            image = image.convert('RGB')
        
        pdf_buffer = io.BytesIO()
        image.save(pdf_buffer, format='PDF', resolution=300)
        return pdf_buffer.getvalue()

# æ¨¡æ¿ç¤ºä¾‹ templates/posters/tech-modern.html
"""
<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            margin: 0;
            width: 1200px;
            height: 1600px;
            background: linear-gradient(135deg, {{ colors[0] }}, {{ colors[1] }});
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            padding: 80px;
            box-sizing: border-box;
        }
        .product-name {
            font-size: 72px;
            font-weight: bold;
            margin-bottom: 40px;
            text-align: center;
        }
        .description {
            font-size: 32px;
            text-align: center;
            line-height: 1.6;
            opacity: 0.9;
        }
        .features {
            margin-top: 60px;
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .feature-tag {
            background: rgba(255,255,255,0.2);
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <div class="product-name">{{ product_name }}</div>
    <div class="description">{{ description }}</div>
    <div class="features">
        {% for feature in features %}
        <span class="feature-tag">{{ feature }}</span>
        {% endfor %}
    </div>
</body>
</html>
"""
```

#### ä»»åŠ¡1.3ï¼šå‰ç«¯APIå¯¹æ¥

**ç›®æ ‡**ï¼šå‰ç«¯è°ƒç”¨çœŸå®åç«¯API

**å®ç°å†…å®¹**ï¼š
```typescript
// frontend/lib/api/client.ts
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api/v1';

class ApiClient {
  private token: string | null = null;
  
  async request<T>(endpoint: string, options: RequestInit = {}): Promise<T> {
    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
      ...options,
      headers: {
        'Content-Type': 'application/json',
        ...(this.token && { Authorization: `Bearer ${this.token}` }),
        ...options.headers,
      },
    });
    
    if (!response.ok) {
      throw new ApiError(response.status, await response.text());
    }
    
    return response.json();
  }
  
  // æµ·æŠ¥ç”Ÿæˆ
  async generatePoster(data: PosterGenerationRequest): Promise<GenerationResponse> {
    return this.request('/posters/generate', {
      method: 'POST',
      body: JSON.stringify(data),
    });
  }
  
  async getGenerationStatus(id: string): Promise<GenerationResponse> {
    return this.request(`/posters/generations/${id}`);
  }
  
  // è½®è¯¢çŠ¶æ€
  async pollGenerationStatus(
    id: string, 
    onUpdate: (status: GenerationResponse) => void,
    interval = 2000
  ): Promise<void> {
    const poll = async () => {
      const status = await this.getGenerationStatus(id);
      onUpdate(status);
      
      if (status.status === 'processing') {
        setTimeout(poll, interval);
      }
    };
    await poll();
  }
}

// ä½¿ç”¨ React Query ç®¡ç†çŠ¶æ€
// frontend/hooks/usePosterGeneration.ts
import { useMutation, useQuery } from '@tanstack/react-query';

export function usePosterGeneration() {
  const generateMutation = useMutation({
    mutationFn: apiClient.generatePoster.bind(apiClient),
  });
  
  const useGenerationStatus = (id: string | null) => {
    return useQuery({
      queryKey: ['generation', id],
      queryFn: () => apiClient.getGenerationStatus(id!),
      enabled: !!id,
      refetchInterval: (data) => 
        data?.status === 'processing' ? 2000 : false,
    });
  };
  
  return { generateMutation, useGenerationStatus };
}
```

### 5.2 é˜¶æ®µäºŒï¼šåŠŸèƒ½æ‰©å±•ï¼ˆé¢„è®¡3-4å‘¨ï¼‰

#### ä»»åŠ¡2.1ï¼šIPé“¸é€ å‚åç«¯

```python
# backend/app/api/v1/ip.py
from fastapi import APIRouter
from pydantic import BaseModel

router = APIRouter()

class IPGenerationRequest(BaseModel):
    product_name: str
    product_description: str
    style: str = "cute"  # cute, tech, professional
    format: str = "stl"  # stl, obj, glb

@router.post("/generate")
async def generate_ip(request: IPGenerationRequest):
    """
    ç”Ÿæˆ3D IPå½¢è±¡
    å¯æ¥å…¥ Tripo3D / Meshy API
    """
    # æ–¹æ¡ˆ1: ä½¿ç”¨ Tripo3D API
    # æ–¹æ¡ˆ2: ä½¿ç”¨ Meshy API
    # æ–¹æ¡ˆ3: æœ¬åœ° Stable Diffusion + 3Dç”Ÿæˆ
    pass

@router.get("/models/{model_id}/download")
async def download_model(model_id: str, format: str = "stl"):
    """ä¸‹è½½3Dæ¨¡å‹æ–‡ä»¶"""
    pass
```

**æ¨èçš„3Dç”ŸæˆæœåŠ¡**ï¼š
| æœåŠ¡ | ä»·æ ¼ | è´¨é‡ | é›†æˆéš¾åº¦ |
|------|------|------|----------|
| Tripo3D | $$$ | â­â­â­â­â­ | ä½ |
| Meshy | $$ | â­â­â­â­ | ä½ |
| CSM.ai | $$ | â­â­â­â­ | ä¸­ |
| æœ¬åœ°Stable Zero123 | å…è´¹ | â­â­â­ | é«˜ |

#### ä»»åŠ¡2.2ï¼šè¯­éŸ³è§£è¯´å‘˜åç«¯

```python
# backend/app/api/v1/voice.py
from fastapi import APIRouter
from pydantic import BaseModel
from typing import Optional

router = APIRouter()

class VoiceGenerationRequest(BaseModel):
    text: str
    voice_style: str = "professional"  # professional, casual, energetic
    language: str = "zh-CN"
    speed: float = 1.0

@router.post("/generate")
async def generate_voice(request: VoiceGenerationRequest):
    """
    è¯­éŸ³åˆæˆ
    å¯æ¥å…¥ Azure Speech / ElevenLabs
    """
    if settings.AZURE_SPEECH_KEY:
        return await generate_with_azure(request)
    elif settings.ELEVENLABS_API_KEY:
        return await generate_with_elevenlabs(request)
    else:
        return await generate_mock(request)

async def generate_with_azure(request: VoiceGenerationRequest) -> dict:
    import azure.cognitiveservices.speech as speechsdk
    
    speech_config = speechsdk.SpeechConfig(
        subscription=settings.AZURE_SPEECH_KEY,
        region=settings.AZURE_SPEECH_REGION
    )
    
    # é€‰æ‹©éŸ³è‰²
    voice_map = {
        "professional": "zh-CN-YunxiNeural",
        "casual": "zh-CN-XiaoxiaoNeural",
        "energetic": "zh-CN-YunyeNeural"
    }
    speech_config.speech_synthesis_voice_name = voice_map.get(
        request.voice_style, "zh-CN-YunxiNeural"
    )
    
    # ç”Ÿæˆè¯­éŸ³
    synthesizer = speechsdk.SpeechSynthesizer(speech_config=speech_config)
    result = synthesizer.speak_text_async(request.text).get()
    
    # ä¿å­˜éŸ³é¢‘æ–‡ä»¶
    audio_path = f"generated/voice_{uuid.uuid4()}.mp3"
    with open(audio_path, "wb") as f:
        f.write(result.audio_data)
    
    return {
        "id": generation_id,
        "audio_url": f"/download/{audio_path}",
        "duration": len(request.text) * 0.3,  # ä¼°ç®—æ—¶é•¿
        "voice_style": request.voice_style
    }
```

#### ä»»åŠ¡2.3ï¼šè§†é¢‘ç”Ÿæˆå¢å¼º

```python
# backend/app/services/video_generator.py
class VideoGenerator:
    """è§†é¢‘ç”ŸæˆæœåŠ¡"""
    
    async def generate_video(self, script: VideoScript, product: Product) -> str:
        """
        ç”Ÿæˆå®Œæ•´è§†é¢‘
        1. æ ¹æ®è„šæœ¬ç”Ÿæˆå„åœºæ™¯å›¾ç‰‡ (AIç”Ÿæˆæˆ–æ¨¡æ¿)
        2. ç”Ÿæˆè¯­éŸ³æ—ç™½
        3. åˆæˆè§†é¢‘ (FFmpeg)
        4. æ·»åŠ å­—å¹•
        5. æ·»åŠ èƒŒæ™¯éŸ³ä¹
        """
        scenes = []
        
        for scene in script.scenes:
            # ç”Ÿæˆåœºæ™¯å›¾ç‰‡
            image_path = await self.generate_scene_image(
                scene.visual_description
            )
            
            # ç”Ÿæˆè¯­éŸ³
            audio_path = await self.generate_narration(
                scene.narration,
                scene.duration
            )
            
            scenes.append({
                "image": image_path,
                "audio": audio_path,
                "duration": scene.duration,
                "subtitle": scene.subtitle
            })
        
        # ä½¿ç”¨FFmpegåˆæˆè§†é¢‘
        video_path = await self.compose_video(scenes)
        
        return video_path
    
    async def compose_video(self, scenes: list) -> str:
        """ä½¿ç”¨FFmpegåˆæˆè§†é¢‘"""
        import ffmpeg
        
        # æ„å»ºFFmpegå‘½ä»¤
        # ffmpeg -i scene1.mp4 -i scene2.mp4 ... -filter_complex concat...
        pass
```

### 5.3 é˜¶æ®µä¸‰ï¼šå•†ä¸šåŒ–ä¸é«˜çº§åŠŸèƒ½ï¼ˆé¢„è®¡4-6å‘¨ï¼‰

#### ä»»åŠ¡3.1ï¼šæ”¯ä»˜è®¢é˜…ç³»ç»Ÿ

```python
# backend/app/api/v1/payments.py
from fastapi import APIRouter
from pydantic import BaseModel

router = APIRouter()

class SubscriptionPlan(BaseModel):
    id: str
    name: str
    price_monthly: int  # åˆ†
    price_yearly: int
    features: list
    limits: dict  # ç”Ÿæˆæ¬¡æ•°é™åˆ¶

PLANS = [
    {
        "id": "free",
        "name": "å…è´¹ç‰ˆ",
        "price_monthly": 0,
        "limits": {
            "posters_per_month": 5,
            "videos_per_month": 1,
            "max_resolution": "1080p"
        }
    },
    {
        "id": "pro",
        "name": "ä¸“ä¸šç‰ˆ",
        "price_monthly": 2990,  # Â¥29.90
        "limits": {
            "posters_per_month": 100,
            "videos_per_month": 20,
            "max_resolution": "4K",
            "remove_watermark": True
        }
    },
    {
        "id": "team",
        "name": "å›¢é˜Ÿç‰ˆ",
        "price_monthly": 9990,  # Â¥99.90
        "limits": {
            "posters_per_month": -1,  # æ— é™
            "videos_per_month": -1,
            "team_members": 5,
            "api_access": True
        }
    }
]

# é›†æˆ Stripe / Paddle / æ”¯ä»˜å® / å¾®ä¿¡æ”¯ä»˜
```

#### ä»»åŠ¡3.2ï¼šç”¨æˆ·æƒé™ä¸å›¢é˜Ÿåä½œ

```python
# backend/app/models/team.py
from pydantic import BaseModel, Field
from datetime import datetime
from enum import Enum

class Role(str, Enum):
    OWNER = "owner"
    ADMIN = "admin"
    EDITOR = "editor"
    VIEWER = "viewer"

class TeamMember(BaseModel):
    user_id: str
    team_id: str
    role: Role
    joined_at: datetime
    invited_by: str

class Team(BaseModel):
    id: str
    name: str
    owner_id: str
    members: list[TeamMember]
    plan_id: str
    created_at: datetime

# Permission decorators
from functools import wraps
from fastapi import HTTPException, status

def require_role(min_role: Role):
    def decorator(func):
        @wraps(func)
        async def wrapper(*args, current_user: User = Depends(get_current_user), **kwargs):
            # æ£€æŸ¥ç”¨æˆ·æƒé™
            member = await get_team_member(current_user.id, kwargs.get('team_id'))
            if not member or ROLE_HIERARCHY[member.role] < ROLE_HIERARCHY[min_role]:
                raise HTTPException(
                    status_code=status.HTTP_403_FORBIDDEN,
                    detail="Insufficient permissions"
                )
            return await func(*args, current_user=current_user, **kwargs)
        return wrapper
    return decorator
```

#### ä»»åŠ¡3.3ï¼šåä½œç©ºé—´ (WebSocket)

```python
# backend/app/websocket/collaboration.py
from fastapi import WebSocket, WebSocketDisconnect
from typing import Dict, List
import json
from ypy_websocket import YDoc, WebsocketProvider

class CollaborationManager:
    def __init__(self):
        self.rooms: Dict[str, List[WebSocket]] = {}
        self.docs: Dict[str, YDoc] = {}
    
    async def connect(self, websocket: WebSocket, room_id: str, user: User):
        await websocket.accept()
        
        if room_id not in self.rooms:
            self.rooms[room_id] = []
            self.docs[room_id] = YDoc()
        
        self.rooms[room_id].append(websocket)
        
        # å‘é€å½“å‰æ–‡æ¡£çŠ¶æ€
        await websocket.send_json({
            "type": "init",
            "data": self.docs[room_id].get_state()
        })
        
        # å¹¿æ’­ç”¨æˆ·åŠ å…¥
        await self.broadcast(room_id, {
            "type": "user_joined",
            "user": user.username
        }, exclude=websocket)
    
    async def handle_message(self, websocket: WebSocket, room_id: str, message: dict):
        """å¤„ç†åä½œæ¶ˆæ¯"""
        msg_type = message.get("type")
        
        if msg_type == "update":
            # æ›´æ–°æ–‡æ¡£
            update = message.get("update")
            self.docs[room_id].apply_update(update)
            
            # å¹¿æ’­ç»™å…¶ä»–ç”¨æˆ·
            await self.broadcast(room_id, {
                "type": "update",
                "update": update,
                "user_id": message.get("user_id")
            }, exclude=websocket)
        
        elif msg_type == "cursor":
            # å…‰æ ‡ä½ç½®
            await self.broadcast(room_id, {
                "type": "cursor",
                "position": message.get("position"),
                "user_id": message.get("user_id")
            }, exclude=websocket)
    
    async def broadcast(self, room_id: str, message: dict, exclude: WebSocket = None):
        for conn in self.rooms.get(room_id, []):
            if conn != exclude:
                await conn.send_json(message)

collab_manager = CollaborationManager()

@router.websocket("/ws/collab/{room_id}")
async def collaboration_endpoint(websocket: WebSocket, room_id: str):
    user = await authenticate_ws(websocket)
    await collab_manager.connect(websocket, room_id, user)
    
    try:
        while True:
            data = await websocket.receive_json()
            await collab_manager.handle_message(websocket, room_id, data)
    except WebSocketDisconnect:
        await collab_manager.disconnect(websocket, room_id, user)
```

#### ä»»åŠ¡3.4ï¼šæ•°æ®é­”é•œ (åˆ†æç³»ç»Ÿ)

```python
# backend/app/services/analytics.py
class AnalyticsService:
    """æ•°æ®åˆ†ææœåŠ¡"""
    
    async def track_generation(self, user_id: str, generation_type: str, metadata: dict):
        """è¿½è¸ªç”Ÿæˆäº‹ä»¶"""
        await db.analytics.insert_one({
            "event_type": "generation",
            "user_id": user_id,
            "generation_type": generation_type,
            "metadata": metadata,
            "timestamp": datetime.utcnow()
        })
    
    async def get_user_insights(self, user_id: str) -> dict:
        """è·å–ç”¨æˆ·æ´å¯Ÿ"""
        pipeline = [
            {"$match": {"user_id": user_id}},
            {"$group": {
                "_id": "$generation_type",
                "count": {"$sum": 1},
                "avg_generation_time": {"$avg": "$metadata.generation_time"}
            }}
        ]
        
        results = await db.analytics.aggregate(pipeline).to_list(None)
        
        return {
            "total_generations": sum(r["count"] for r in results),
            "breakdown_by_type": results,
            "most_active_day": await self.get_most_active_day(user_id),
            "usage_trend": await self.get_usage_trend(user_id)
        }
    
    async def ab_test_analysis(self, test_id: str) -> dict:
        """A/Bæµ‹è¯•ç»“æœåˆ†æ"""
        # æ¯”è¾ƒä¸¤ä¸ªç‰ˆæœ¬çš„æµ·æŠ¥/è§†é¢‘çš„ç‚¹å‡»ç‡ã€è½¬åŒ–ç‡
        pass
```

### 5.4 é˜¶æ®µå››ï¼šæ€§èƒ½ä¼˜åŒ–ä¸è¿ç»´ï¼ˆæŒç»­ï¼‰

#### ä»»åŠ¡4.1ï¼šç¼“å­˜ç­–ç•¥

```python
# backend/app/core/cache.py
from functools import wraps
import pickle
import hashlib

class CacheService:
    def __init__(self):
        self.redis = redis_client
    
    async def get(self, key: str) -> any:
        data = await self.redis.get(key)
        return pickle.loads(data) if data else None
    
    async def set(self, key: str, value: any, ttl: int = 3600):
        await self.redis.setex(
            key, 
            ttl, 
            pickle.dumps(value)
        )
    
    def cached(self, ttl: int = 3600, key_prefix: str = ""):
        """ç¼“å­˜è£…é¥°å™¨"""
        def decorator(func):
            @wraps(func)
            async def wrapper(*args, **kwargs):
                # ç”Ÿæˆç¼“å­˜key
                cache_key = f"{key_prefix}:{func.__name__}:{hashlib.md5(str(args).encode()).hexdigest()}"
                
                # å°è¯•è·å–ç¼“å­˜
                cached = await self.get(cache_key)
                if cached:
                    return cached
                
                # æ‰§è¡Œå‡½æ•°
                result = await func(*args, **kwargs)
                
                # å†™å…¥ç¼“å­˜
                await self.set(cache_key, result, ttl)
                
                return result
            return wrapper
        return decorator

cache = CacheService()

# ä½¿ç”¨ç¤ºä¾‹
@cache.cached(ttl=3600, key_prefix="templates")
async def get_templates():
    return await db.templates.find().to_list(None)
```

#### ä»»åŠ¡4.2ï¼šä»»åŠ¡é˜Ÿåˆ—

```python
# backend/app/worker/celery_app.py
from celery import Celery
from celery.signals import task_postrun

celery_app = Celery(
    "pitchcube",
    broker="redis://localhost:6379/1",
    backend="redis://localhost:6379/2"
)

@celery_app.task(bind=True, max_retries=3)
def generate_poster_task(self, generation_id: str, request_data: dict):
    """å¼‚æ­¥æµ·æŠ¥ç”Ÿæˆä»»åŠ¡"""
    try:
        # æ›´æ–°çŠ¶æ€ä¸º processing
        update_generation_status(generation_id, "processing")
        
        # ç”Ÿæˆæµ·æŠ¥
        generator = PosterRenderer()
        result = generator.render_poster(request_data)
        
        # ä¿å­˜æ–‡ä»¶
        file_path = save_generated_file(generation_id, result)
        
        # æ›´æ–°çŠ¶æ€ä¸º completed
        update_generation_status(
            generation_id, 
            "completed",
            file_path=file_path
        )
        
        return {"status": "success", "file_path": file_path}
        
    except Exception as exc:
        # æ›´æ–°çŠ¶æ€ä¸º failed
        update_generation_status(generation_id, "failed", error=str(exc))
        
        # é‡è¯•
        raise self.retry(exc=exc, countdown=60)

# è¿›åº¦å›è°ƒ
@task_postrun.connect
def task_postrun_handler(task_id, task, retval, state):
    # WebSocketé€šçŸ¥å‰ç«¯ä»»åŠ¡å®Œæˆ
    asyncio.create_task(notify_task_complete(task_id, state))
```

#### ä»»åŠ¡4.3ï¼šç›‘æ§ä¸æ—¥å¿—

```python
# backend/app/core/monitoring.py
from prometheus_client import Counter, Histogram, Gauge
import time

# æŒ‡æ ‡å®šä¹‰
GENERATION_COUNTER = Counter(
    'poster_generations_total',
    'Total poster generations',
    ['status', 'template_id']
)

GENERATION_DURATION = Histogram(
    'poster_generation_duration_seconds',
    'Time spent generating posters',
    ['template_id']
)

ACTIVE_GENERATIONS = Gauge(
    'active_generations',
    'Number of generations in progress'
)

# ç›‘æ§è£…é¥°å™¨
def monitor_generation(func):
    @wraps(func)
    async def wrapper(*args, **kwargs):
        template_id = kwargs.get('template_id', 'unknown')
        
        ACTIVE_GENERATIONS.inc()
        start_time = time.time()
        
        try:
            result = await func(*args, **kwargs)
            GENERATION_COUNTER.labels(
                status='success',
                template_id=template_id
            ).inc()
            return result
        except Exception as e:
            GENERATION_COUNTER.labels(
                status='failed',
                template_id=template_id
            ).inc()
            raise
        finally:
            ACTIVE_GENERATIONS.dec()
            GENERATION_DURATION.labels(
                template_id=template_id
            ).observe(time.time() - start_time)
    
    return wrapper
```

---

## ğŸ“… å…­ã€å®æ–½è·¯çº¿å›¾

```
æœˆä»½:    ç¬¬1æœˆ        ç¬¬2æœˆ        ç¬¬3æœˆ        ç¬¬4æœˆ
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
é˜¶æ®µä¸€:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
        æ•°æ®åº“å®Œå–„   æµ·æŠ¥å¼•æ“     APIå¯¹æ¥

é˜¶æ®µäºŒ:              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                    IPåç«¯      è¯­éŸ³åç«¯     è§†é¢‘å¢å¼º

é˜¶æ®µä¸‰:                          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                                æ”¯ä»˜ç³»ç»Ÿ     åä½œç©ºé—´     æ•°æ®åˆ†æ

é˜¶æ®µå››:                                      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                                            æ€§èƒ½ä¼˜åŒ–     ç›‘æ§è¿ç»´     æµ‹è¯•ä¸Šçº¿

é‡Œç¨‹ç¢‘:  M1          M2          M3          M4
        MVPå¯ç”¨     åŠŸèƒ½å®Œæ•´    å•†ä¸šåŒ–      æ­£å¼å‘å¸ƒ
```

### é‡Œç¨‹ç¢‘å®šä¹‰

| é‡Œç¨‹ç¢‘ | æ—¥æœŸ | ç›®æ ‡ | éªŒæ”¶æ ‡å‡† |
|--------|------|------|----------|
| M1 | ç¬¬4å‘¨æœ« | MVPå¯ç”¨ | æ•°æ®åº“æŒä¹…åŒ– + çœŸå®æµ·æŠ¥ç”Ÿæˆ |
| M2 | ç¬¬8å‘¨æœ« | åŠŸèƒ½å®Œæ•´ | å…­å¤§æ¨¡å—å…¨éƒ¨å¯ç”¨ |
| M3 | ç¬¬12å‘¨æœ« | å•†ä¸šåŒ– | æ”¯ä»˜ç³»ç»Ÿ + è®¢é˜…ç®¡ç† |
| M4 | ç¬¬16å‘¨æœ« | æ­£å¼å‘å¸ƒ | æ€§èƒ½ä¼˜åŒ– + å®Œæ•´æµ‹è¯• |

---

## ğŸ’° ä¸ƒã€æˆæœ¬ä¼°ç®—

### 7.1 å¼€å‘æˆæœ¬

| è§’è‰² | äººæ•° | æ—¶é—´ | æœˆæˆæœ¬ | æ€»æˆæœ¬ |
|------|------|------|--------|--------|
| å…¨æ ˆå·¥ç¨‹å¸ˆ | 1 | 4ä¸ªæœˆ | Â¥25,000 | Â¥100,000 |
| å‰ç«¯å·¥ç¨‹å¸ˆ | 1 | 3ä¸ªæœˆ | Â¥20,000 | Â¥60,000 |
| UI/UXè®¾è®¡å¸ˆ | 0.5 | 2ä¸ªæœˆ | Â¥15,000 | Â¥15,000 |
| **åˆè®¡** | | | | **Â¥175,000** |

### 7.2 è¿è¥æˆæœ¬ï¼ˆæœˆåº¦ï¼‰

| é¡¹ç›® | é…ç½® | æœˆè´¹ç”¨ |
|------|------|--------|
| æœåŠ¡å™¨ | 4æ ¸8GB x 2 | Â¥400 |
| MongoDB Atlas | M10é›†ç¾¤ | Â¥500 |
| Redis Cloud | 5GB | Â¥200 |
| å¯¹è±¡å­˜å‚¨ | 100GB | Â¥100 |
| CDN | 1TBæµé‡ | Â¥200 |
| AIæœåŠ¡ | æŒ‰éœ€ | Â¥500-2000 |
| **åˆè®¡** | | **Â¥1900-3400/æœˆ** |

### 7.3 AIæœåŠ¡æˆæœ¬ä¼°ç®—

| æœåŠ¡ | å•ä»· | é¢„ä¼°æœˆç”¨é‡ | æœˆè´¹ç”¨ |
|------|------|------------|--------|
| OpenAI GPT-4 | $0.03/1K tokens | 500K tokens | $15 |
| Stability AI | $0.2/å›¾åƒ | 500å¼  | $100 |
| Azure Speech | $16/ç™¾ä¸‡å­—ç¬¦ | 100ä¸‡å­—ç¬¦ | $16 |
| Tripo3D | $0.5/æ¨¡å‹ | 100ä¸ª | $50 |
| **åˆè®¡** | | | **~$180/æœˆ** |

---

## ğŸ¯ å…«ã€ä¼˜å…ˆçº§å»ºè®®

### é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å¼€å§‹ï¼‰

1. **æ•°æ®åº“æŒä¹…åŒ–** - æ‰€æœ‰æ•°æ®å½“å‰æ˜¯Mockï¼Œå¿…é¡»ä¼˜å…ˆè§£å†³
2. **æµ·æŠ¥çœŸå®ç”Ÿæˆ** - æ ¸å¿ƒä¸šåŠ¡ï¼Œä½¿ç”¨HTMLæ¸²æŸ“æ–¹æ¡ˆå¿«é€Ÿå®ç°
3. **å‰ç«¯APIå¯¹æ¥** - è¿æ¥å‰åç«¯ï¼Œå®ç°å®Œæ•´ç”¨æˆ·æµç¨‹

### ä¸­ä¼˜å…ˆçº§ï¼ˆç¬¬2ä¸ªæœˆï¼‰

4. **IP/è¯­éŸ³åç«¯** - å®Œå–„äº§å“åŠŸèƒ½çŸ©é˜µ
5. **è§†é¢‘å¢å¼º** - ä»è„šæœ¬åˆ°å®Œæ•´è§†é¢‘çš„ç”Ÿæˆ
6. **æ¨¡æ¿ç®¡ç†ç³»ç»Ÿ** - æ”¯æŒåŠ¨æ€æ·»åŠ æ¨¡æ¿

### ä½ä¼˜å…ˆçº§ï¼ˆç¬¬3-4ä¸ªæœˆï¼‰

7. **æ”¯ä»˜è®¢é˜…** - å•†ä¸šåŒ–å‡†å¤‡
8. **åä½œç©ºé—´** - å·®å¼‚åŒ–ç«äº‰
9. **æ•°æ®åˆ†æ** - ä¼˜åŒ–äº§å“ä½“éªŒ

---

## âœ… ä¹ã€æ£€æŸ¥æ¸…å•

### å‘å¸ƒå‰æ£€æŸ¥

- [ ] æ‰€æœ‰APIä½¿ç”¨çœŸå®æ•°æ®åº“
- [ ] æµ·æŠ¥ç”Ÿæˆè¿”å›çœŸå®å›¾ç‰‡
- [ ] å‰ç«¯æ­£ç¡®è°ƒç”¨åç«¯API
- [ ] ç”¨æˆ·è®¤è¯æµç¨‹å®Œæ•´
- [ ] æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½æ­£å¸¸
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] å®‰å…¨å®¡è®¡é€šè¿‡
- [ ] æ–‡æ¡£å®Œæ•´
- [ ] ç›‘æ§å‘Šè­¦é…ç½®

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-02-01  
**ä½œè€…**: AI Assistant
